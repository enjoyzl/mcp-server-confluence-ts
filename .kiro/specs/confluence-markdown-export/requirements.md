# 需求文档

## 介绍

此功能为现有的 MCP Confluence 服务添加将 Confluence 页面导出为 Markdown 文件到当前工作空间的能力。用户可以导出单个页面或整个页面层次结构，并可选择按章节/段落将内容拆分为多个文件。这扩展了现有的 MCP Confluence 服务，支持内容迁移和本地文档工作流程。

## 需求

### 需求 1

**用户故事：** 作为开发者，我希望将 Confluence 页面导出为 Markdown 文件到本地工作空间，以便我可以在本地处理内容或将其迁移到其他文档系统。

#### 验收标准

1. 当用户指定页面 ID 或 URL 时，系统应从 Confluence 检索页面内容
2. 当检索到页面内容时，系统应将其从 Confluence 存储格式转换为清洁的 Markdown
3. 当转换完成时，系统应将 Markdown 文件保存到当前工作空间
4. 当保存文件时，系统应使用页面标题作为文件名，扩展名为 .md
5. 如果文件名已存在，系统应提示确认或自动重命名添加后缀

### 需求 2

**用户故事：** 作为文档维护者，我希望导出页面层次结构及其所有子页面，以便我可以在本地保留完整的文档结构。

#### 验收标准

1. 当用户请求层次导出时，系统应递归识别所有子页面
2. 当处理子页面时，系统应在文件系统中维护层次结构
3. 当创建目录时，系统应使用页面标题作为文件夹名称（为文件系统兼容性进行清理）
4. 当页面既有内容又有子页面时，系统应创建内容文件和子目录
5. 如果层次结构很深，系统应限制递归深度以防止无限循环

### 需求 3

**用户故事：** 作为内容编辑者，我希望按章节或段落拆分大型页面，以便我可以处理可管理的文件大小并更好地组织内容。

#### 验收标准

1. 当用户启用章节拆分时，系统应分析页面内容的标题结构
2. 当检测标题时，系统应基于 H1 或 H2 标题识别拆分点
3. 当拆分内容时，系统应为每个章节/段落创建单独的文件
4. 当命名拆分文件时，系统应使用标题文本作为文件名的一部分
5. 当创建拆分文件时，系统应保留段落之间的内部链接和引用
6. 如果未找到合适的标题，系统应导出为单个文件并发出警告

### 需求 4

**用户故事：** 作为用户，我希望配置导出选项，如输出目录和文件命名约定，以便导出的文件符合我的工作空间组织。

#### 验收标准

1. 当启动导出时，系统应允许指定工作空间内的目标目录
2. 当未指定目录时，系统应使用默认的 "confluence-export" 目录
3. 当处理文件名时，系统应为跨平台兼容性进行清理
4. 当处理特殊字符时，系统应用安全的替代字符替换它们
5. 如果目标目录不存在，系统应自动创建它

### 需求 5

**用户故事：** 作为开发者，我希望保留元数据和附件信息，以便在导出过程中不丢失重要的上下文。

#### 验收标准

1. 当导出页面时，系统应将元数据作为 YAML frontmatter 包含
2. 当处理附件时，系统应在元数据中列出它们及下载链接
3. 当遇到嵌入图像时，系统应将它们转换为带有 Confluence URL 的 Markdown 图像语法
4. 当处理宏时，系统应将支持的宏转换为 Markdown 等效项或保留为 HTML 注释
5. 如果发现不支持的内容，系统应记录警告并按原样保留内容

### 需求 6

**用户故事：** 作为用户，我希望获得导出进度和结果的清晰反馈，以便我知道导出了什么并可以排除任何问题。

#### 验收标准

1. 当开始导出时，系统应显示进度信息
2. 当处理多个页面时，系统应显示当前正在处理的页面
3. 当导出完成时，系统应提供导出文件的摘要
4. 当发生错误时，系统应记录带有页面信息的详细错误消息
5. 如果某些页面失败，系统应继续处理剩余页面并在最后报告失败